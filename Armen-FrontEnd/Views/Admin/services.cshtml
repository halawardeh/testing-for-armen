@{
    ViewData["Title"] = "الخدمات الإدارية";
    Layout = "~/Views/Shared/AdminLayout.cshtml";
}

<div class="container py-4" dir="rtl">
    <h2 class="mb-4 text-center" style="color: #025F70; font-weight: 700;">الخدمات الإدارية للفنادق والمدن في الصين</h2>
    <div class="action-buttons mb-4">
        <button class="btn btn-add" onclick="showCityModal('add')">
            <i class="fas fa-plus-circle"></i> إضافة مدينة جديدة
        </button>
        <button class="btn btn-primary btn-add" style="background-color: #025F70; border: none;" onclick="goToBookingRequests()">
            <i class="fas fa-clipboard-list"></i> عرض طلبات الحجز
        </button>

    </div>
    <div id="chinaCitiesWithHotels">
        <!-- سيتم عرض المدن الصينية وجداول الفنادق التابعة لها ديناميكياً -->
    </div>
</div>

<!-- Modal فندق -->
<div class="modal fade" id="hotelModal" tabindex="-1" aria-labelledby="hotelModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="hotelModalLabel">إضافة / تعديل فندق</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
            </div>
            <div class="modal-body">
                <form id="hotelForm">
                    <input type="hidden" id="hotelId">
                    <div class="mb-3">
                        <label for="hotelName" class="form-label">اسم الفندق</label>
                        <input type="text" class="form-control" id="hotelName" required>
                    </div>
                    <div class="mb-3">
                        <label for="hotelCity" class="form-label">المدينة</label>
                        <select class="form-select" id="hotelCity" required>
                            <!-- سيتم تعبئة المدن ديناميكياً -->
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="hotelRating" class="form-label">تصنيف الفندق</label>
                        <select class="form-select" id="hotelRating" required>
                            <option value="">اختر التصنيف</option>
                            <option value="5 نجوم">5 نجوم</option>
                            <option value="4 نجوم">4 نجوم</option>
                            <option value="3 نجوم">3 نجوم</option>
                        </select>
                    </div>
                    <button type="submit" class="btn w-100" style="background-color: #025F70; color: #fff;">حفظ</button>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Modal تفاصيل الفندق -->
<div class="modal fade" id="hotelDetailsModal" tabindex="-1" aria-labelledby="hotelDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="hotelDetailsModalLabel">تفاصيل الفندق</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
            </div>
            <div class="modal-body" id="hotelDetailsBody">
                <!-- تفاصيل الفندق -->
            </div>
        </div>
    </div>
</div>
<!-- Modal مدينة -->
<div class="modal fade" id="cityModal" tabindex="-1" aria-labelledby="cityModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cityModalLabel">إضافة / تعديل مدينة</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
            </div>
            <div class="modal-body">
                <form id="cityForm">
                    <input type="hidden" id="cityId">
                    <div class="mb-3">
                        <label for="cityName" class="form-label">اسم المدينة</label>
                        <input type="text" class="form-control" id="cityName" value="الصين" required>
                    </div>
                    <div class="mb-3">
                        <label for="cityCountry" class="form-label">الدولة</label>
                        <input type="text" class="form-control" id="cityCountry" value="الصين" required>
                    </div>
                    <div class="mb-3">
                        <label for="cityHotels" class="form-label">عدد الفنادق</label>
                        <input type="number" class="form-control" id="cityHotels" min="0" required>
                    </div>
                    <button type="submit" class="btn w-100" style="background-color: #025F70; color: #fff;">حفظ</button>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Modal تفاصيل المدينة -->
<div class="modal fade" id="cityDetailsModal" tabindex="-1" aria-labelledby="cityDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cityDetailsModalLabel">تفاصيل المدينة</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
            </div>
            <div class="modal-body" id="cityDetailsBody">
                <!-- تفاصيل المدينة -->
            </div>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        .btn-add {
            background-color: #025F70 !important;
            color: white;
            font-weight: 600;
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            transition: all 0.3s;
            border: none;
        }
        .btn-add:hover {
            background-color: #014452 !important;
            transform: translateY(-2px);
        }
        .table th, .table td {
            vertical-align: middle;
        }
        .table thead, .card-header {
            background-color: #025F70 !important;
            color: #fff !important;
        }
        .city-section {
            margin-bottom: 2rem;
        }
        .city-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #025F70;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .city-title .add-hotel-btn {
            margin-right: 10px;
        }
    </style>
}
@section Scripts {
<script>
let hotels = [
    {id: 1, name: "فندق الصين الدولي", city: "بكين", rating: "5 نجوم"},
    {id: 2, name: "فندق شنغهاي", city: "شنغهاي", rating: "4 نجوم"},
    {id: 3, name: "فندق بكين", city: "بكين", rating: "5 نجوم"},
    {id: 4, name: "فندق قوانغتشو", city: "قوانغتشو", rating: "4 نجوم"}
];
let cities = [
    {id: 1, name: "بكين", country: "الصين", hotels: 15},
    {id: 2, name: "شنغهاي", country: "الصين", hotels: 10},
    {id: 3, name: "قوانغتشو", country: "الصين", hotels: 5}
];
function renderChinaCitiesWithHotels() {
    const container = document.getElementById('chinaCitiesWithHotels');
    container.innerHTML = cities.map(city => {
        const cityHotels = hotels.filter(h => h.city === city.name);
        return `
        <div class="city-section">
            <div class="city-title">
                <span><i class="fas fa-city"></i> ${city.name} <span style="font-size:0.9rem;color:#888;">(${city.country})</span></span>
                <button class="btn btn-sm btn-add add-hotel-btn" onclick="showHotelModalForCity('${city.name}')"><i class="fas fa-plus"></i> إضافة فندق</button>
            </div>
            <table class="table table-bordered table-hover text-center">
                <thead style="background-color: #025F70; color: #fff;">
                    <tr>
                        <th>اسم الفندق</th>
                        <th>التصنيف</th>
                        <th>الإجراءات</th>
                    </tr>
                </thead>
                <tbody>
                    ${cityHotels.length > 0 ? cityHotels.map(h => `
                        <tr>
                            <td>${h.name}</td>
                            <td>${h.rating}</td>
                            <td>
                                <button class='btn btn-sm btn-outline-info' onclick='showHotelDetails(${h.id})'><i class='fas fa-info-circle'></i></button>
                                <button class='btn btn-sm btn-outline-warning' onclick='showHotelModal("edit", ${h.id})'><i class='fas fa-edit'></i></button>
                                <button class='btn btn-sm btn-outline-danger' onclick='deleteHotel(${h.id})'><i class='fas fa-trash-alt'></i></button>
                            </td>
                        </tr>
                    `).join('') : `<tr><td colspan='3'>لا يوجد فنادق في هذه المدينة</td></tr>`}
                </tbody>
            </table>
        </div>
        `;
    }).join('');
}
function fillHotelCityOptions(selectedCity = null) {
    const select = document.getElementById('hotelCity');
    select.innerHTML = cities.map(city => `<option value="${city.name}">${city.name}</option>`).join('');
    if(selectedCity) select.value = selectedCity;
}
function showHotelModal(mode, id) {
    const modal = new bootstrap.Modal(document.getElementById('hotelModal'));
    document.getElementById('hotelForm').reset();
    document.getElementById('hotelId').value = '';
    fillHotelCityOptions();
    if(mode === 'edit' && id) {
        const h = hotels.find(x => x.id === id);
        if(h) {
            document.getElementById('hotelId').value = h.id;
            document.getElementById('hotelName').value = h.name;
            document.getElementById('hotelCity').value = h.city;
            document.getElementById('hotelRating').value = h.rating;
        }
        document.getElementById('hotelModalLabel').innerText = 'تعديل فندق';
    } else {
        document.getElementById('hotelModalLabel').innerText = 'إضافة فندق جديد';
    }
    modal.show();
}
function showHotelModalForCity(cityName) {
    showHotelModal('add');
    fillHotelCityOptions(cityName);
}
document.getElementById('hotelForm').onsubmit = function(e) {
    e.preventDefault();
    const id = document.getElementById('hotelId').value;
    const name = document.getElementById('hotelName').value;
    const city = document.getElementById('hotelCity').value;
    const rating = document.getElementById('hotelRating').value;
    if(id) {
        // تعديل
        const idx = hotels.findIndex(x => x.id == id);
        hotels[idx] = {id: Number(id), name, city, rating};
    } else {
        // إضافة
        hotels.push({id: Date.now(), name, city, rating});
    }
    bootstrap.Modal.getInstance(document.getElementById('hotelModal')).hide();
    renderChinaCitiesWithHotels();
};
function showHotelDetails(id) {
    const h = hotels.find(x => x.id === id);
    if(!h) return;
    document.getElementById('hotelDetailsBody').innerHTML = `
        <div class="mb-3"><strong>اسم الفندق:</strong> ${h.name}</div>
        <div class="mb-3"><strong>المدينة:</strong> ${h.city}</div>
        <div class="mb-3"><strong>التصنيف:</strong> ${h.rating}</div>
    `;
    new bootstrap.Modal(document.getElementById('hotelDetailsModal')).show();
}
function deleteHotel(id) {
    if(confirm('هل أنت متأكد من حذف الفندق؟')) {
        hotels = hotels.filter(x => x.id !== id);
        renderChinaCitiesWithHotels();
    }
}
function showCityModal(mode, id) {
    const modal = new bootstrap.Modal(document.getElementById('cityModal'));
    document.getElementById('cityForm').reset();
    document.getElementById('cityId').value = '';
    if(mode === 'edit' && id) {
        const c = cities.find(x => x.id === id);
        if(c) {
            document.getElementById('cityId').value = c.id;
            document.getElementById('cityName').value = c.name;
            document.getElementById('cityCountry').value = c.country;
            document.getElementById('cityHotels').value = c.hotels;
        }
        document.getElementById('cityModalLabel').innerText = 'تعديل مدينة';
    } else {
        document.getElementById('cityModalLabel').innerText = 'إضافة مدينة جديدة';
    }
    modal.show();
}
document.getElementById('cityForm').onsubmit = function(e) {
    e.preventDefault();
    const id = document.getElementById('cityId').value;
    const name = document.getElementById('cityName').value;
    const country = document.getElementById('cityCountry').value;
    const hotelsCount = document.getElementById('cityHotels').value;
    if(id) {
        // تعديل
        const idx = cities.findIndex(x => x.id == id);
        cities[idx] = {id: Number(id), name, country, hotels: hotelsCount};
    } else {
        cities.push({id: Date.now(), name, country, hotels: hotelsCount});
    }
    bootstrap.Modal.getInstance(document.getElementById('cityModal')).hide();
    renderChinaCitiesWithHotels();
};
function showCityDetails(id) {
    const c = cities.find(x => x.id === id);
    if(!c) return;
    document.getElementById('cityDetailsBody').innerHTML = `
        <div class="mb-3"><strong>اسم المدينة:</strong> ${c.name}</div>
        <div class="mb-3"><strong>الدولة:</strong> ${c.country}</div>
        <div class="mb-3"><strong>عدد الفنادق:</strong> ${c.hotels}</div>
    `;
    new bootstrap.Modal(document.getElementById('cityDetailsModal')).show();
}
function deleteCity(id) {
    if(confirm('هل أنت متأكد من حذف المدينة؟ سيتم حذف جميع الفنادق التابعة لها أيضًا.')) {
        const city = cities.find(x => x.id === id);
        if(city) {
            hotels = hotels.filter(h => h.city !== city.name);
        }
        cities = cities.filter(x => x.id !== id);
        renderChinaCitiesWithHotels();
    }
}
function goToBookingRequests() {
    window.location.href = '/Admin/BookingRequests';
}
document.addEventListener('DOMContentLoaded', function() {
    renderChinaCitiesWithHotels();
});
</script>
}